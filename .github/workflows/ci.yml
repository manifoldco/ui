name: CI

on:
  deployment_status:
    branches:
      - sslotsky/test-cafe-action

jobs:
  spit:
    runs-on: ubuntu-18.04
    steps:
      - name: Tell me some stuff
        run: |
          echo deployment_url ${{ github.event.deployment_status.deployment_url }},
          echo deployment.url ${{ github.event.deployment_status.deployment.url }},
          echo target_url ${{ github.event.deployment_status.target_url }},
          echo state ${{ github.event.deployment_status.state }},
          echo login ${{ github.event.deployment_status.creator.login }},
  test:
    env:
      DEPLOY_URL: ${{ github.event.deployment_status.target_url }}
    if:
      github.event.deployment_status.state == 'SUCCESS' &&
      github.event.deployment_status.creator.login == 'now[bot]'
    name: Run e2e tests with test cafe
    runs-on: ubuntu-18.04
    steps:
      - name: Install dependencies
        run: npm install
      - name: Where the hell am I?
        run: pwd
      - name: Run TestCafe
        run: npm run testcafe

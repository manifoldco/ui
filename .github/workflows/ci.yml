name: CI

on:
  deployment_status:
    branches:
      - sslotsky/test-cafe-action

jobs:
  spit:
    steps:
      - name: Tell me some stuff
        run: |
          echo ${{ github.event.deployment_status.deployment_url }},
          echo ${{ github.event.deployment_status.state }},
          echo ${{ github.event.deployment_status.creator.login }},
  test:
    env:
      DEPLOY_URL: ${{ github.event.deployment_status.deployment_url }}
    if:
      github.event.deployment_status.state == 'SUCCESS' &&
      github.event.deployment_status.creator.login == 'now'
    name: Run e2e tests with test cafe
    runs-on: ubuntu-18.04
    steps:
      - name: Install dependencies
        run: npm install
      - name: Run TestCafe
        run: npm run testcafe

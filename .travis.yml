language: node_js
node_js:
  - 11.9.0
cache: npm
before_install:
  - echo "//registry.npmjs.org/:_authToken=$(npx @manifoldco/cli export -t manifold
    -p manifold-ui-ci | grep NPM_TOKEN | cut -f2 -d "=")" >> ~/.npmrc
stages:
  - test
  - publish
jobs:
  include:
    - stage: test
      name: "\U0001F4D0 Profile bundle"
      script: npm run profile
    - stage: test
      name: "\U0001F9F9 Run linters"
      script: npm run lint
    - stage: test
      name: "\U0001F5DC️ Run tests"
      script: npm run test:coverage
    - stage: test
      name: "\U0001F5DC️ Run visual regression tests"
      script: npm run happo-ci-travis
    - stage: publish
      name: Publish to npm
      script: npm run publish
      if: tag IS present
after_success:
  - npx codecov
env:
  global:
    - secure: aBjUssWAzc5/tSAGmkmJb1MUERNq6rV+ZmiGVQWFfnkv0CKoYQSpSe4+ZVvWymE2BItUohRYB0V4fCQTI0fnm9Jk9IKmyJuDoVGIA0+6YeNYwnVVM5AtFAtrdwok7J/bV8gtAzJkFhqIw1H3PLvhQLugQuT2nDe9qS3sDOC0dpMgOBdtGg6dahR7xlWbRFAYvUoDKk5OQxJMXYPMslYawLEmg9C/etisJgNzGm3xQyH7iIJnPwz660zgYAsEYeK7pZYXM737sqeZoU6+LcHZS6jJkYyL+oXRq/m8eTYapJOShWarN/moqgnVnmce+QIuMRSzOzmOSJEkxr6aoxnSQOhlbnVIMJXJyKrX7rubhDPtkCtsdhjFhdPzNLNabzY4dpbzvBtqTUCp+p5PItFfP/h2gIvduVsAJlY9lL8xiLl734LFtKp0bT/bv4LHiA4M/sgWprFfWWd8SVzQMpDG4YV6Rpva7yobhUCZxvHO0i0SowXRscAGf18DHM7IjrZ1bFeY2iPuC7bZXtSKytf7b/8y0/5JH4WJY3FZqSxLPBfel9uyiSp71CSGj9WR0xeoiXsl7XpYCcPLWTvLI/FhyFtGV91+CNEb+8DCPENmXZnwM9KEeiHklqfNfkAAsrrwvpo1ujJnhfN17dXq+/XGBuWUbX+OvbDfduk6J9b7JGI=
    - secure: vqP2ckgL6t40uQjBNo4FjlF85wxtiBRmJwtALms7gzBy2gS7B2dWmDC1cQEOcjb43oO+hTT12udtSOAD732dTWEGdPV9QIrnCtY2a1BNCKhx/jmTvjmeUXJlfSUVikbk1k8BGrtc/q7g65NeyfIwcmLnfn0XaBh546bOKkooaCFQQOmnQClYxjSzL+HOt6WJtze0wPG6Q4Y/29vD9MGv/LDTRlllWegjWhG1syMLqiahbsi2TeGVnw9rEPQ461aqrr2QWOq8FFD7kNjAlgOT4TKn8a6uwMUSqRmMcb5WArpZ2vzLH3gK2JgUJHTojqgk6cKK1t//RCJhsYuFKLtxqIJ/3XmYlH7qxM/PzHbSSIzmWycornYH2Kyk4s5jGfByHLsfq/jpDjSldTdGRuVa6Tl1siq/ZI2ovVfv8876oVjd/VPUH+MeT7SsUX9igUPga4X+f0IsrPah35FLAAZ1+uRunp8+10dnyo1uyaM2QduZgFBXCj2Vf9o3xyX6LGANFr+yiXjRYwcmZTS2IRK5aDF9AHWZrt+DAwMN/1Vgv1nxrYogViagOSV21SI28m0Rs6E/wRpp0p+kAiyVOsxHNmEJkJLKmHfzIKoA8mK74BMsqavgK7sp9C7IML1wxgn7Zq9Nn35HkqjT516BxhMikNVnhQmBeaCscCwd/LhdHf0=
